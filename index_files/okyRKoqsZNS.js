/*!CK:1287212515!*//*1420431576,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["Xu6wE"]); }

__d("SearchFunnelTypeaheadLogger",["Arbiter","Banzai","DOM","Event","PageTransitions","SubscriptionsHandler","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n='search_funnel',o='search_end_to_end',p={focus:'entrant',render:'results_displayed',keydown:'interaction',select:'search'},q,r={init:function(s,t){if(!s||!t)return;this._isColdStart=true;this._sampleRates=t;this._core=s.getCore();this._data=s.getData();this._view=s.getView();this._handler=new l();this.log=this.log.bind(this);this.onKeydown=this.onKeydown.bind(this);this.onSelect=this.onSelect.bind(this);this.onTypeaheadImpression=this.onTypeaheadImpression.bind(this);this._transitionInProgress=true;this.onTypeaheadImpression();},onTypeaheadImpression:function(s){this._initTime=this._getInitTime();this.e2eMarkers=[];if(this._transitionInProgress&&i.scry(document.body,'.fbPhotoSnowlift').length===0)this.log('impression',{funnel_path:m.getNextURI().path});this.reset();this._handler.addSubscriptions(this._core.subscribeOnce('focus',this.log),this._view.subscribeOnce('render',this.log),this._view.subscribeOnce('select',this.onSelect));j.listen(this._core.getElement(),'keydown',this.onKeydown);k.registerHandler(function(){this._transitionInProgress=true;}.bind(this));k.registerCompletionCallback(this.onTypeaheadImpression);},onKeydown:function(event){if(!this._sawKeydown){this._sawKeydown=true;this.log('keydown',event);}},onSelect:function(event,s){s.funnel_data={selected_position:s.selected.globalIndex,selected_type:s.selected.type};if(s.selected.isNullState){s.funnel_data.interaction_type='null_state';}else if(s.selected.isSingleState){s.funnel_data.interaction_type='single_state';}else s.funnel_data.interaction_type='typed';this._endToEndPath=m.getMostRecentURI().path;q=null;g.subscribe('BigPipe/init',function(event,t){if(!t.arbiter)return;var u={arbiter:t.arbiter,event:'ajaxpipe/onload_callback',markers:this.e2eMarkers,init_time:this._initTime,from_path:this._endToEndPath};setTimeout(function(){this.setupE2EPerfLogging(u);}.bind(this),0);}.bind(this));this.log(event,s);},reset:function(){this._handler.release();this._handler.engage();this._sawKeydown=false;this._transitionInProgress=false;},log:function(s,t){if(p[s])s=p[s];this.e2eMarkers.push({event:s,time:String(Date.now()-this._initTime)});if(!this._sampleRates[s])return;t=t||{};t.funnel_data=t.funnel_data||{};t.funnel_data.sample_rate=this._sampleRates[s];t.funnel_data.current_event_time=Date.now();if(this._prevTime&&this._prevEvt){t.funnel_data.previous_event_time=this._prevTime;t.funnel_data.previous_event=this._prevEvt;}this._prevTime=t.funnel_data.current_event_time;this._prevEvt=s;h.post(n,{funnel_data:t.funnel_data,path:t.funnel_path||k.getMostRecentURI().path,stage:s},h.VITAL);},setupE2EPerfLogging:function(s){return s.arbiter.subscribeOnce(s.event,function(t){if(q)return;q=true;s.markers.push({event:'end',time:String(Date.now()-s.init_time)});h.post(o,{from_path:this._endToEndPath,to_path:m.getNextURI().path,markers:s.markers,cold_start:this._isColdStart},h.VITAL);this._isColdStart=false;}.bind(this));},_getInitTime:function(){if(window.ExitTime)return window.ExitTime;var s=window.performance||window.msPerformance;if(!s||!s.timing)return;return s.timing.navigationStart;}};e.exports=r;},null);
__d("TypeaheadRecentSearchUpdater",["Arbiter"],function(a,b,c,d,e,f,g){function h(i){"use strict";this.view=i.getView();}h.prototype.enable=function(){"use strict";this.updaterSubscription=this.view.subscribe('select',function(){g.inform('search/refreshRecentSearchesNullstate',{},g.BEHAVIOR_STATE);});};h.prototype.disable=function(){"use strict";this.view.unsubscribe(this.updaterSubscription);};e.exports=h;},null);